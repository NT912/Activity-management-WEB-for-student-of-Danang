<!DOCTYPE html>
<html lang="en">
    <%- include('../includes/head.ejs', { title: activity.name }) %>
    <style>
        .status-label {
            background: linear-gradient(90deg, #00791c, #809c87);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
            display: inline-block;
        }
    </style>
<body class="color-theme-blue mont-font">

    <div class="main-wrapper">

        <!-- navigation top-->
        <%- include('../includes/header.ejs', { userss: userss }) %>
        <!-- navigation top -->

        <!-- navigation left -->
        <%- include('../includes/nav.ejs', { userss: userss }) %>
        <!-- navigation left -->

        <!-- main content -->
        <div class="main-content d-flex flex-wrap" style="margin-right: 0;">
            <div class="col-xl-6 d-flex" style="margin-right: 20px; min-width: 700px;">
                <div class="col-xl-12" style="max-width: 1000px;">
                    <div class="card w-100 shadow-xss rounded-xxl border-0 mb-3">
                        <div class="card-header d-flex align-items-center p-4">
                            <figure class="avatar me-3">
                                <img src="<%= activity.avt %>" alt="image" class="shadow-sm rounded-circle w45">
                            </figure>
                            <h4>
                                <a href="/user/<%= activity.organization_id%>/view" class="fw-700 text-grey-900 font-xssss mt-1">
                                    <%= activity.username %>
                                </a>
                                <span class="d-block font-xssss fw-500 mt-1 lh-3 text-grey-500">3 giờ trước </span>
                            </h4>

                            <span class="status-label ms-auto">Trạng thái: <%= state %></span>

                            <a href="#" class="ms-auto" id="dropdownMenu2" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="ti-more-alt text-grey-900 btn-round-md bg-greylight font-xss"></i>
                            </a>
                            <div class="dropdown-menu dropdown-menu-end p-4 rounded-xxl border-0 shadow-lg" aria-labelledby="dropdownMenu2">
                                <div class="card-body p-0 d-flex">
                                    <i class="feather-bookmark text-grey-500 me-3 font-lg"></i>
                                    <h4 class="fw-600 text-grey-900 font-xssss mt-0 me-4">Lưu bài viết
                                        <span class="d-block font-xsssss fw-500 mt-1 lh-3 text-grey-500">Thêm bài này vào mục đã lưu của bạn</span>
                                    </h4>
                                </div>
                            </div>
                        </div>
                        <div class="card-body p-4">
                            <p class="fw-500 text-grey-500 lh-26 font-xs w-100"><%= activity.name %></p>
                            <p class="fw-600 text-grey-500 lh-26 font-xsss w-100">
                                <%= `Thời gian diễn ra hoạt động: ${activity.start_date.toLocaleDateString()} - ${activity.end_date.toLocaleDateString()}` %>
                            </p>
                            <p class="fw-600 text-grey-500 lh-26 font-xsss w-100">
                                <%= `Thời gian cho phép đăng ký: ${activity.registration_start_date.toLocaleDateString()} - ${activity.registration_end_date.toLocaleDateString()}` %>
                            </p>
                            <p class="fw-600 text-grey-500 lh-26 font-xsss w-100">
                                <%= `Địa điểm: ${activity.location}` %>
                            </p>    
                        </div>
                        <div class="card-body d-block p-0" style="max-height: 500px; overflow: hidden; margin-bottom: 30px;">
                            <div class="row ps-2 pe-2">
                                <div class="col-xs-4 col-sm-12 p-1">
                                    <a href="<%= activity.image %>">
                                        <img src="<%= activity.image %>" class="card-img-top" alt="image">
                                    </a>
                                </div>
                            </div>
                        </div>
                        <div class="card-body p-4">
                            <p id="additionalContent_<%= activity.Id_activity %>" class="fw-500 text-grey-500 lh-26 font-xsss w-100">
                                <%- activity.description.replace(/\n/g, '<br>') %>
                            </p>
                        </div>
                        
                        <div class="card-body d-flex align-items-center pt-0 ps-4 pe-4 pb-4">
                            <a href="/activity/<%= activity.id %>/registration/" class="p-2 lh-20 w100 bg-primary-gradiant me-2 text-white text-center font-xssss fw-600 ls-1 rounded-xl">
                                Danh sách
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-5 bg-greylight" style="max-width: 700px; min-width: 700px;">
                <div class="feedback-section">
                    <h4 class="font-xssss fw-600 text-center">Phản hồi từ admin</h4>
                    <div class="col-xl-12 mb-3">
                        <textarea id="adminFeedback" name="adminFeedback" class="col-xl-12" placeholder="Nội dung hoạt động" style="height: 400px;">
                            <%= activity.comment %>
                        </textarea>
                    </div>
                </div>
                <div class="d-flex justify-content-center">
                    <% if (stateact == 'yet' || stateact == 'update') { %>
                        <button id="confirmButton" type="button" class="btn btn-success me-2" onclick="AdminReplyPost('confirm')">Duyệt</button>
                        <button id="rejectButton" type="button" class="btn btn-warning me-2" onclick="AdminReplyPost('reject')">Từ chối</button>
                    <% } else if (stateact == 'reject') { %>
                        <button id="confirmButton" type="button" class="btn btn-success me-2" onclick="AdminReplyPost('confirm')">Duyệt</button>
                    <% } else if (stateact == 'confirm') { %>
                        <button id="rejectButton" type="button" class="btn btn-warning me-2" onclick="AdminReplyPost('reject')">Hủy duyệt</button>
                    <% } else if (stateact == 'done') { %>
                        <a href="/activity/<%= activity.id %>/delete" class="p-2 lh-20 w100 bg-primary-gradiant me-2 text-white text-center font-xssss fw-600 ls-1 rounded-xl">Xóa</a>
                    <% } %>
                </div>
            </div>
            
            <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
            <link href="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.18/summernote.min.css" rel="stylesheet">
            <script src="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.18/summernote.min.js"></script>
            <script src="/js/action.js"></script>
            <script src="/js/plugin.js"></script>
            <script src="/js/lightbox.js"></script>
            <script src="/js/scripts.js"></script>
            
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <% if (announc != '') {%>
        <script>
            $(function(){
                toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": true,
                        "positionClass": "toast-top-right",
                        "preventDuplicates": false,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "3000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    }
                toastr.info('<%- announc %>');
            })
        </script>
    <%}%>
        <script>
            async function AdminReplyPost(mod) {
                try {
                    const feedback = document.getElementById('adminFeedback').value;
                    const response = await fetch(`/admin/activity/<%= activity.id %>/${mod}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ adminFeedback: feedback })
                    });
    
                    if (response.ok) {
                        if (mod == 'confirm'){
                            toastr.success('duyet hoạt động thành công!');
                        } else {
                            toastr.success('Xoa hoạt động thành công!');
                        }
                        setTimeout(() => {
                            window.location.reload(); // Tải lại trang sau khi lưu thành công
                        }, 1500);
                    } else {
                        const errorData = await response.json();
                        if (mod == 'confirm'){
                            toastr.success('duyet hoạt động thất bại!!');
                        } else {
                            toastr.success('Xoa hoạt động thất bại!!');
                        }
                        toastr.error(errorData.message || 'Lưu hoạt động ');
                    }
                } catch (error) {
                    console.error('Error saving activity:', error);
                    toastr.error('Đã xảy ra lỗi khi lưu hoạt động!');
                }
            }
        </script>
    <style>
        #adminFeedback {
            line-height: 1.5;
            background-color: #f9f9f9;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }
    </style>
</body>
</html>
