<!DOCTYPE html>
<html lang="en">
<%- include('../includes/head.ejs', { title: activity.name }) %>
    <style>
        .status-label {
            background: linear-gradient(90deg, #00791c, #809c87);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
            display: inline-block;
        }
    </style>

    <body class="color-theme-blue mont-font">

        <div class="main-wrapperr">

            <!-- navigation top-->
            <%- include('../includes/header.ejs', { userss: userss }) %>
                <!-- navigation top -->

                <!-- navigation left -->
                <%- include('../includes/nav.ejs', { userss: userss }) %>
                    <!-- navigation left -->

                    <!-- main content -->
                    <div class="main-content d-flex" style="margin-right: 0;">
                        <div class="col-xl-6 d-flex" style="margin-right: 20px;">
                            <div class="col-xl-12" style="max-width: 1000px;">
                                <div class="card w-100 shadow-xss rounded-xxl border-0 mb-3">
                                    <div class="card-header d-flex align-items-center p-4">
                                        <figure class="avatar me-3">
                                            <img src="<%= activity.avt %>" alt="image"
                                                class="shadow-sm rounded-circle w45">
                                        </figure>
                                        <h4 class="fw-700 text-grey-900 font-xssss mt-1">
                                            <a href="/user/<%-activity.organization_id%>/view"
                                                class="fw-700 text-grey-900 font-xssss mt-1">
                                                <%= activity.username %>
                                            </a>
                                            <span class="d-block font-xssss fw-500 mt-1 lh-3 text-grey-500">
                                                <%= activity.created_at %>
                                            </span>
                                        </h4>
                                        <a href="#" class="ms-auto" id="dropdownMenu2" data-bs-toggle="dropdown"
                                            aria-expanded="false"><i
                                                class="ti-more-alt text-grey-900 btn-round-md bg-greylight font-xss"></i></a>
                                        <div class="dropdown-menu dropdown-menu-end p-4 rounded-xxl border-0 shadow-lg"
                                            aria-labelledby="dropdownMenu2">
                                            <div class="card-body p-0 d-flex">
                                                <i class="feather-bookmark text-grey-500 me-3 font-lg"></i>
                                                <h4 class="fw-600 text-grey-900 font-xssss mt-0 me-4">
                                                    <a class="save-activity" data-id="<%- activity.id %>"
                                                        onclick="SavePost(<%- activity.id %>)">Lưu lại hoạt động</a>
                                                    <span class="d-block font-xsssss fw-500 mt-1 lh-3 text-grey-500">
                                                        Thêm bài này vào mục đã lưu của bạn
                                                    </span>
                                                </h4>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card-body p-4">
                                        <p class="fw-500 text-grey-500 lh-26 font-xs w-100">
                                            <%= activity.name %>
                                        </p>
                                        <p class="fw-600 text-grey-500 lh-26 font-xsss w-100">
                                            Thời gian diễn ra hoạt động: <%= activity.start_date.toLocaleDateString() %>
                                                - <%= activity.end_date.toLocaleDateString() %>
                                        </p>
                                        <p class="fw-600 text-grey-500 lh-26 font-xsss w-100">
                                            Thời gian cho phép đăng ký: <%=
                                                activity.registration_start_date.toLocaleDateString() %> - <%=
                                                    activity.registration_end_date.toLocaleDateString() %>
                                        </p>
                                        <p class="fw-600 text-grey-500 lh-26 font-xsss w-100">
                                            Địa điểm: <%= activity.location %>
                                        </p>
                                        <p class="fw-600 text-grey-500 lh-26 font-xsss w-100">
                                            Số lượng đăng ký tối đa: <%= activity.maxnumber %>
                                        </p>
                                    </div>
                                    <div class="card-body d-block p-0"
                                        style="max-height: 500px; overflow: hidden; margin-bottom: 30px;">
                                        <div class="row ps-2 pe-2">
                                            <div class="col-xs-4 col-sm-12 p-1">
                                                <a href="<%= activity.image %>">
                                                    <img src="<%= activity.image %>" class="card-img-top" alt="image">
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card-body p-4">
                                        <p id="additionalContent_<%= activity.Id_activity %>"
                                            class="fw-500 text-grey-500 lh-26 font-xsss w-100">
                                            <%- activity.description.replace(/\n/g, '<br>' ) %>
                                        </p>
                                    </div>

                                    <div class="card-body d-flex align-items-center pt-0 ps-4 pe-4 pb-4">
                                        <a href="/activity/<%= activity.id %>/registration/"
                                            class="p-2 lh-20 w100 bg-primary-gradiant me-2 text-white text-center font-xssss fw-600 ls-1 rounded-xl">
                                            Danh sách
                                        </a>
                                        <% if (allowRegister) { %>
                                            <% if (!registered) { %>
                                                <button type="button"
                                                    class="p-2 lh-20 w100 bg-primary-gradiant me-2 text-white text-center font-xssss fw-600 ls-1 rounded-xl"
                                                    data-bs-toggle="modal" data-bs-target="#registerModal"
                                                    onclick="loadRegisterForm('<%= activity.id %>')">Đăng ký</button>
                                                <% } else { %>
                                                    <button type="button"
                                                        class="p-2 lh-20 bg-danger me-2 text-white text-center font-xssss fw-600 ls-1 rounded-xl"
                                                        data-bs-toggle="modal" data-bs-target="#confirmUnregisterModal">
                                                        Hủy đăng ký
                                                    </button>
                                                    <!-- Modal Xác nhận hủy đăng ký -->
                                                    <div class="modal fade" id="confirmUnregisterModal" tabindex="-1"
                                                        aria-labelledby="confirmUnregisterModalLabel"
                                                        aria-hidden="true">
                                                        <div class="modal-dialog">
                                                            <div class="modal-content">
                                                                <div class="modal-header">
                                                                    <h5 class="modal-title"
                                                                        id="confirmUnregisterModalLabel">Xác nhận hủy
                                                                        đăng ký</h5>
                                                                    <button type="button" class="btn-close"
                                                                        data-bs-dismiss="modal"
                                                                        aria-label="Close"></button>
                                                                </div>
                                                                <div class="modal-body">
                                                                    Bạn có chắc chắn muốn hủy đăng ký hoạt động này
                                                                    không?
                                                                </div>
                                                                <div class="modal-footer">
                                                                    <button type="button" class="btn btn-secondary"
                                                                        data-bs-dismiss="modal">Hủy</button>
                                                                    <a href="/activity/<%= activity.id %>/unregister"
                                                                        id="confirmUnregisterBtn"
                                                                        class="btn btn-danger">Xác nhận hủy đăng ký</a>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <% } %>
                                                        <% } %>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
        </div>

        <!-- Modal -->
        <div class="modal fade" id="registerModal" tabindex="-1" aria-labelledby="registerModalLabel"
            aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="registerModalLabel">Đăng Ký Hoạt Động</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <!-- Form đăng ký sẽ được chèn vào đây -->
                    </div>
                </div>
            </div>
        </div>

        <script src="/js/plugin.js"></script>
        <script src="/js/action.js"></script>
        <script src="/js/lightbox.js"></script>
        <script src="/js/scripts.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
        <% if (announc !='' ) {%>
            <script>
                $(function () {
                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": true,
                        "positionClass": "toast-top-right",
                        "preventDuplicates": false,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "3000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    }
                    toastr.info('<%- announc %>');
                })
            </script>
            <%}%>

    </body>

</html>